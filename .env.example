# ===========================================
# Application
# ===========================================
NEXT_PUBLIC_APP_URL=http://localhost:3000
PORT=3000

# ===========================================
# Database (PostgreSQL)
# ===========================================
DATABASE_URL=postgres://user:password@localhost:5432/database

# Connection Pooling
# Controls maximum connections per app instance to prevent exhaustion
# Recommended values by deployment type:
#   Serverless (Vercel/Netlify): 3-5
#   Containers (Railway/Render): 5-10
#   Dedicated servers: 10-20
# For 100+ concurrent instances, use external pooler (PgBouncer). See /docs/DEPLOYMENT.md
DATABASE_POOL_SIZE=5
DATABASE_IDLE_TIMEOUT=20
DATABASE_CONNECT_TIMEOUT=10

# ===========================================
# Encryption (Sensitive Data at Rest)
# ===========================================
# Required in development + production
# Encrypts TOTP secrets, OAuth tokens, and settings marked sensitive: true
# Uses AES-256-GCM with scrypt key derivation
# Generate with: openssl rand -hex 32
# See /docs/ENCRYPTION.md for details
ENCRYPTION_KEY=generate-a-secure-secret-with-openssl-rand-base64-32
# Legacy keys for key rotation (comma-separated, decrypt only)
# When rotating: set new key above, move old key here, comma-separate multiple old keys
# Run `npm run db:reencrypt` to migrate data, then remove legacy keys
ENCRYPTION_KEYS_LEGACY=

# ===========================================
# Auth.js (NextAuth v5)
# ===========================================
# AUTH_URL is required in production, optional in development
AUTH_URL=http://localhost:3000
# Required in development + production
AUTH_SECRET=generate-a-secure-secret-with-openssl-rand-base64-32
# Recommended in development and when behind a proxy
AUTH_TRUST_HOST=false
# Absolute session lifetime in days (default: 45)
# Sessions cannot be extended beyond this limit, even with activity
# Prevents indefinite session extension from stolen credentials
SESSION_ABSOLUTE_LIFETIME_DAYS=45

# ===========================================
# Google OAuth (User Login)
# Create credentials at: https://console.cloud.google.com/apis/credentials
# Redirect URI: {AUTH_URL}/api/auth/callback/google
# ===========================================
# Optional in development + production (only required if you enable Google login)
NEXT_PUBLIC_AUTH_GOOGLE_CLIENT_ID=
AUTH_GOOGLE_SECRET=

# ===========================================
# Passkeys / WebAuthn (Optional)
# ===========================================
# Optional in development + production (only required if you enable passkeys)
# Passwordless authentication with biometrics, security keys, or device screen locks
# Passkeys registered on one domain won't work on another
# See /docs/PASSKEYS.md for detailed configuration
WEBAUTHN_RP_ID=localhost
WEBAUTHN_ORIGINS=http://localhost:3000

# ===========================================
# Gmail API (Email Sending)
# Create OAuth credentials with Gmail API enabled
# Scopes: gmail.send, gmail.readonly
# Generate refresh token using OAuth Playground:
#   https://developers.google.com/oauthplayground/
# Test with: npm run test:email -- --to your@email.com
# ===========================================
# Optional in development + production.
# Required if you use email-based features (invites, password resets, email 2FA, security alerts).
GMAIL_CLIENT_ID=
GMAIL_CLIENT_SECRET=
GMAIL_REFRESH_TOKEN=
GMAIL_FROM_EMAIL=

# ===========================================
# Google Cloud Storage (File Uploads)
# Create a service account with Storage Admin role
# Paste the entire JSON key as GOOGLE_CLOUD_CREDENTIALS
# ===========================================
# Optional in development + production.
# Required if you use uploads/avatars/image management.
GOOGLE_CLOUD_PROJECT_ID=
GOOGLE_CLOUD_STORAGE_BUCKET=
GOOGLE_CLOUD_CREDENTIALS=

# ===========================================
# Redis (Rate Limiting, Caching, & Queues)
# ===========================================
# Single Redis connection for:
#   - Rate limiting (rate-limiter-flexible)
#   - Session update tokens (impersonation, step-up auth)
#   - Login protection (failed attempt tracking)
#   - Version caching (database query optimization)
#   - Background jobs (BullMQ queue workers)
# Format: redis://default:password@host:6379 or rediss://... (TLS)
# Optional in development (rate limiting gracefully degrades).
# Required in production (auth/security endpoints fail-closed if missing).
REDIS_URL=

# Version Cache Control
# Enable/disable database query caching for ETag version checks (default: disabled)
# Set to "false" to bypass Redis cache and always query database directly
# Useful for debugging or if you want to disable caching without removing Redis config
ENABLE_VERSION_CACHE=false

# Worker concurrency for BullMQ background jobs (default: 5)
QUEUE_CONCURRENCY=5

# ===========================================
# Cron Jobs
# ===========================================
# Secret for authorizing cron job endpoints (e.g., /api/cron/cleanup)
# Used by external cron services (Vercel Cron, Railway, etc.)
# Generate with: openssl rand -hex 32
CRON_SECRET=

# ===========================================
# Development / Testing
# ===========================================
# Default password for users created by `npm run db:reset` script
# ONLY used for local development to quickly seed test users
# Do NOT use in production - this is purely for convenience during development
TEST_DEFAULT_PASSWORD=

